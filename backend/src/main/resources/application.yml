server:
  port: 8080

spring:
  application:
    name: rapidphotoflow
  servlet:
    multipart:
      max-file-size: 150MB
      max-request-size: 500MB

  # Database configuration - uses environment variables from ECS
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/rapidphotoflow}
    username: ${SPRING_DATASOURCE_USERNAME:postgres}
    password: ${SPRING_DATASOURCE_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000

  # JPA configuration
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  # Security / OAuth2 Resource Server
  security:
    oauth2:
      resourceserver:
        jwt:
          # Set by Terraform via environment variable; falls back to placeholder for local dev
          issuer-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI:}

# AWS Configuration
aws:
  region: ${AWS_REGION:us-east-1}
  s3:
    bucket:
      photos: ${S3_BUCKET_PHOTOS:}

# Actuator for health checks
management:
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: always

# OpenAPI configuration
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method

# AI Service configuration - uses Service Discovery in AWS (ai-service.rpf-dev.local)
ai:
  service:
    url: ${AI_SERVICE_URL:http://localhost:3001}
    auto-tag-on-upload: false  # Disabled by default - controlled via frontend toggle

# Image conversion configuration
image:
  conversion:
    temp-dir: ${IMAGE_TEMP_DIR:/tmp/imageconv}
    timeout-seconds: ${IMAGE_CONVERSION_TIMEOUT:120}
    jpeg-quality: ${IMAGE_JPEG_QUALITY:0.9}
    svg-max-dimension: ${SVG_MAX_DIMENSION:1920}

# Logging
logging:
  level:
    com.rapidphotoflow: DEBUG
    org.hibernate.SQL: WARN
    org.hibernate.type.descriptor.sql.BasicBinder: WARN
    root: INFO
